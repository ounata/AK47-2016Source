!function(){"use strict";mcs.ng=mcs.ng||angular.module("mcs.ng",["mcs.ng.datatable","mcs.ng.filesUpload","mcs.ng.uiCopy","mcs.ng.treeControl","mcs.ng.paging","dialogs.main"]),mcs.ng.constant("httpErrorHandleMessage",{404:"no file!",401:"unauthenticated access!",other:""}).service("httpErrorHandleService",function(a,b,c){var d=this;return d.process=function(a){var d="操作失败",e=a.data.message||a.data.description,f=a.data.messageDetail||a.data.stackTrace,g='<span> <a style="cursor:pointer" data-toggle="collapse" data-target="#dialogErrorBody">'+e+'</a></span><div id="dialogErrorBody" class="collapse out">'+f+"</div>";b.error(d,c.trustAsHtml(g))},this}),mcs.ng.factory("safeApply",function(a){return function(a,b){var c=a.$root.$$phase;"$apply"==c||"$digest"==c?b&&"function"==typeof b&&b():a.$apply(b)}}),mcs.ng.factory("eventService",function(){var a=this;return a.registerEvent=function(b){a[b]=[]},a.unRegisterEvent=function(b){delete a[b]},a.fire=function(b,c){a[b].forEach(function(a){a(c)})},a.clearHandler=function(b){a[b]=[]},a.bind=function(b,c){a[b].push(c)},a})}(),function(){"use strict";mcs.ng.filter("props",function(){return function(a,b){var c=[];if(angular.isArray(a)){var d=Object.keys(b);a.forEach(function(a){for(var e=!1,f=0;f<d.length;f++){var g=d[f],h=b[g].toLowerCase();if(-1!==a[g].toString().toLowerCase().indexOf(h)){e=!0;break}}e&&c.push(a)})}else c=a;return c}}),mcs.ng.filter("trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),mcs.ng.filter("normalize",function(){return function(a){return a+="",!mcs.util.bool(a)||a.indexOf("0001-01-01")>-1||a.indexOf("9999-09-09")>-1||a.indexOf("￥")>-1&&0==parseFloat(a.replace("￥",""))?"":a}}),mcs.ng.filter("truncate",function(){return function(a,b){if(!a)return"";if(!b){a=a.replace("，",",");var c=mcs.util.toArray(a);if(c.length>1)return c[0]+"..."}return b>0&&b<a.length?a.substr(0,b)+"...":a}}),mcs.ng.filter("tooltip",function(){return function(a,b){return a?(b=b||10,a&&mcs.util.isString(a)&&a.length>b?a:""):""}}),mcs.ng.filter("rmb",function(){return function(a){if(!/^(0|[1-9]\d*)(\.\d+)?$/.test(a))return"";if(0==parseFloat(a))return"零元整";var b="仟佰拾亿仟佰拾万仟佰拾元角分",c="";a+="00";var d=a.indexOf(".");d>=0&&(a=a.substring(0,d)+a.substr(d+1,2)),b=b.substr(b.length-a.length);for(var e=0;e<a.length;e++)c+="零壹贰叁肆伍陆柒捌玖".charAt(a.charAt(e))+b.charAt(e);return c.replace(/零(仟|佰|拾|角)/g,"零").replace(/(零)+/g,"零").replace(/零(万|亿|元)/g,"$1").replace(/(亿)万|壹(拾)/g,"$1$2").replace(/^元零?|零分/g,"").replace(/元$/g,"元整")}})}(),function(){"use strict";mcs.ng.directive("pptsAutoComplete",function(a,b){var c='<tags-input min-length="1" template="tagItemTemp" add-from-autocomplete-only="{{addJustSuggest != undefined?addJustSuggest:true}}"  ng-blur="tagBlur()" ';return c+='text="text"  max-tags="{{maxTags||1}}" ',c+='ng-model="ngModel" key-property="{{key}}" display-property="{{displayProperty}}" placeholder="{{placeholder}}">',c+='<auto-complete load-on-focus="true" min-length="1" template="autoCompleteItemTemp" display-property="{{fullPath||displayProperty}}" source="query($query)"></auto-complete></tags-input>',{restrict:"E",template:c,scope:{placeholder:"@?",ngModel:"=",resultFilter:"&?",key:"@",async:"=?",addJustSuggest:"=?",minLength:"=?",displayProperty:"@",fullPath:"@?",maxTags:"=?",data:"=",remoteData:"@?",maxQueryResult:"@?",param:"=?"},link:function(c,d,e,f){c.text="";var g='<div class="autoCompleteMatchItem" title="{{data.'+(c.fullPath||c.displayProperty)+'}}"><span ng-bind-html="$highlight(data.'+c.displayProperty+')"></span><span ng-if="data.'+c.fullPath+'">({{data.'+c.fullPath+"}})</span></div>",h='<div uib-popover="{{data.'+(c.fullPath||c.displayProperty)+'}}" class="tag-template" popover-trigger="mouseenter"><span>{{$getDisplayText()}}</span> <a class="remove-button" ng-click="$removeTag()">&#10006;</a></div>';b.put("autoCompleteItemTemp")||b.put("autoCompleteItemTemp",g),b.put("tagItemTemp")||b.put("tagItemTemp",h),c.ngModel=c.ngModel||[],c.tagBlur=function(){c.text=""},c.tagChanged=function(a){c.ngModel.length>c.maxTags&&c.ngModel.pop()},c.query=function(b){if(c.async&&1==c.async)return a.query(c.remoteData,JSON.stringify(angular.extend({searchTerm:b},c.param)),c.resultFilter);var d=[],e=c.resultFilter?c.resultFilter()(c.data):c.data;return e.forEach(function(a){a.name.indexOf(b)>-1&&d.push(a)}),d}}}}),mcs.ng.directive("mcsAutocomplete",["$templateCache","autoCompleteDataService",function(a,b){return{restrict:"E",scope:{css:"@",customStyle:"@",category:"@",placeholder:"@?",model:"=",filter:"&?",async:"@?",minValidLength:"=?",minInputLength:"=?",keyProperty:"@",displayProperty:"@",fullPath:"@?",maxTags:"=?",data:"=",url:"@?",maxQueryResult:"@?",params:"=?"},templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/mcs-autocomplete.tpl.html",controller:function(a){a.async=mcs.util.bool(a.async||!0),a.category=a.category||"",a.placeholder=a.placeholder||"请选择",a.maxTags=a.maxTags||1,a.minValidLength=a.minValidLength||1,a.minInputLength=a.minInputLength||1,a.maxQueryResult=a.maxQueryResult||10},link:function(c,d){c.text="",c.model=c.model||[];var e='<div class="tag-template" uib-popover="{{data.'+c.fullPath+'}}" popover-trigger="mouseenter"><span>{{$getDisplayText()}}</span> <a class="remove-button" ng-click="$removeTag()">&#10006;</a></div>',f='<div class="autocomplete-template" title="{{data.'+c.fullPath+'}}"><span ng-bind-html="$highlight(data.'+c.displayProperty+')"></span><span ng-if="data.'+c.fullPath+'">({{data.'+c.fullPath+"}})</span></div>";a.get(c.category+"tag-template")||a.put(c.category+"tag-template",e),a.get(c.category+"autocomplete-template")||a.put(c.category+"autocomplete-template",f),c.tagBlur=function(){c.text=""},c.tagChanged=function(a){c.model.length>c.maxTags&&c.model.pop()},c.$watch("$parent.model",function(a){var b=c.placeholder;a&&a.length?d.find(".tags input").attr("placeholder",""):d.find(".tags input").attr("placeholder",b).css("width","100%")}),c.query=function(a){if(mcs.util.bool(c.async)){if(!c.url)return;return b.query(c.url,JSON.stringify(angular.extend({searchTerm:a,maxCount:c.maxQueryResult},c.params)),c.filter)}var d=[],e=c.filter?c.filter()(c.data):c.data;return e.forEach(function(b){b.name.indexOf(a)>-1&&d.push(b)}),d}}}}])}(),function(){"use strict";mcs.ng.service("autoCompleteDataService",function(a){var b={};return b.query=function(b,c,d){return a.post(b,c,{headers:{"Content-Type":"application/json",Accept:"application/json",autoComplete:!0}}).then(function(a){return a.data?d?d()(a.data):a.data:void 0})},b})}(),function(){"use strict";mcs.ng.constant("buttonConfig",{categories:["add","edit","delete","search","view","save","cancel","ok","close","print","upload","download","history","export","refresh","submit","approve","reject"],defaultTexts:["新 增","编 辑","删 除","查 询","查 看","保 存","取 消","确 定","关 闭","打 印","上 传","下 载","历 史","导 出","刷 新","提交审批","同 意","驳 回"],sizes:["mini","medium","large"],sizeCss:["btn-xs","btn-sm","btn-lg"],iconClass:["fa-plus","fa-pencil","fa-trash-o","fa-search","fa-eye","fa-save","fa-undo","fa-check","fa-times","fa-print","fa-upload","fa-download","fa-history","fa-share","fa-refresh","fa-arrow-right","fa-check-square","fa-undo"]}).directive("mcsDropdownButton",function(){return{restrict:"E",scope:{category:"@",css:"@",title:"@",items:"=",icon:"@"},templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/mcs-dropdown-button.tpl.html",replace:!0,link:function(a,b,c,d){a.category=a.category||"info",a.title=a.title||"新 增",a.icon?-1==a.icon.indexOf("fa-")&&(a.icon="fa-"+a.icon):a.icon="fa-plus",b.find("i").addClass(a.icon)}}}).directive("mcsButton",function(a){return{restrict:"E",scope:{category:"@",text:"@",icon:"@",size:"@",css:"@",title:"&",click:"&"},template:'<button class="btn" type="button" ng-click="click()" ng-class="{\'mcs-width-130\':category!=\'icon\'}"><i class="ace-icon fa bigger-110"></i><span></span></button>',replace:!0,link:function(b,c,d,e){var f=a.categories.indexOf(b.category),g="btn-info";switch(b.category){case"search":case"view":g="btn-primary";break;case"delete":g="btn-danger";break;case"save":case"ok":case"approve":g="btn-success";break;case"upload":case"download":case"history":case"export":case"print":case"export":case"refresh":case"reject":g="btn-yellow";break;case"submit":g="btn-purple";break;case"cancel":case"close":g="btn-light"}if(c.addClass(g),b.size){var h=a.sizes.indexOf(b.size);c.addClass(a.sizeCss[h])}b.icon&&-1===f?0==b.icon.indexOf("fa-")?c.find("i").addClass(b.icon):c.find("i").addClass("fa-"+b.icon):c.find("i").addClass(a.iconClass[f]),b.css&&c.addClass(b.css),"icon"!=b.category?c.find("span").text(b.text||a.defaultTexts[f]):c.find("span").text("")}}})}(),function(){mcs.ng.directive("mcsCascadingSelect",["$http","mcsValidationService",function(a,b){return{restrict:"E",scope:{level:"@",caption:"@",data:"=?",model:"=?",async:"@",url:"@",path:"@",root:"@",params:"=?",otherParams:"=?",parentKey:"@",customStyle:"@",disabledLevel:"=?",callback:"&"},templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/mcs-cascading-select.tpl.html",replace:!0,controller:function(a){if(a.caption)a.level=mcs.util.toArray(a.caption).length;else{a.level=a.level||3,a.caption=[];for(var b=0;b<a.level;b++)a.caption.push("请选择")}},link:function(c,d,e,f){c.path=mcs.util.bool(c.path||!1),c.root=c.root||"0",c.async=mcs.util.bool(c.async||!0),c.model=c.model||{},c.params=c.params||{},c.parentKey=c.parentKey||"parentKey";var g=function(b,d){if(d){var e=mcs.util.clone(c.model);if(mcs.util.bool(c.async)){if(!c.url)return;a({method:"post",url:c.url,data:c.params,cache:!0}).then(function(a){if(a.data){c.data=c.data||{},c.model=e;for(var f in a.data){var g=a.data[f];c.data[d]=c.data[d]||{},c.data[d][g.key]=g.value}i(b,c.data[d])}})}else{if(void 0==c.data||void 0==typeof c.data[d])return!1;i(b,c.data[d])}}},h=mcs.util.toArray(c.caption);c.$watch("$parent.required",function(){c.$parent.required&&d.attr("required","required"),c.$parent.requiredLevel&&d.attr("required-level",c.$parent.requiredLevel),j()});var i=function(a,b){var e=(d.width()-10*c.level)/c.level,f=a.closest("ul").children().index(a.parent()),i="";if(d.find(".select2-container").width(e),b&&$.each(b,function(b,d){var e='<option value="'+b+'">'+d+"</option>";(c.model&&b==c.model[f]||c.$parent&&b==c.$parent.model[f])&&(i=b),a.append(e)}),a.select2("val",i),i){var j=d.find("select").eq(f+1),k=c.model[f];if(c.path)switch(f){case 0:k=c.root+","+k;break;case 1:k=c.root+","+d.find("select").eq(f-1).val()+","+k;break;case 2:k=c.root+","+d.find("select").eq(f-2).val()+","+d.find("select").eq(f-1).val()+","+k}c.model.selected=c.model.selected||{},c.model.selected[f]=c.model.selected[f]||{},c.model.selected[f].key=k,c.model.selected[f].value=d.find("select").eq(f).select2("data").text;var l=f==h.length-1;if(l&&c.$watch("$scope.model",c.callback),mcs.util.bool(c.async)&&(c.params[c.parentKey]=k,c.otherParams))for(var m in c.params)c.otherParams[m]&&(c.params[m]=c.otherParams[m]);g(j,k)}},j=function(){if(mcs.util.hasAttr(d,"required")||mcs.util.hasAttr(d,"required-level")){var a=d.parent();(c.$parent.required||c.$parent.requiredLevel)&&(a=a.parent());var e=d.closest(".form-group"),f=e.find(".help-block"),i=d.closest(".row"),j=i.find(".form-group");f&&f.length||(1==j.length?e.append('<div class="help-block horizontal"></div>'):a.append('<div class="help-block"></div>'))}$.each(h,function(a,e){var f='<option value="">'+e+"</option>",i=d.find("select").eq(a),j=h.length,k=a==h.length-1;if(c.model[a]=i.val()||c.model[a],c.customStyle&&i.attr("style",c.customStyle),mcs.util.hasAttr(d,"required")||mcs.util.hasAttr(d,"required-level")&&d.attr("required-level")==j)i.attr("required","required");else if(mcs.util.hasAttr(d,"required-level")){var l=parseInt(d.attr("required-level"));l>0&&j>l&&l>a&&i.attr("required-level",d.attr("required-level"))}i.append(f).select2().change(function(){switch(c.model[a]=i.val(),c.model.selected=c.model.selected||{},c.$watch("$scope.model",c.callback),a){case 0:c.model.selected.key=i.val(),c.model.selected.value=i.select2("data").text;break;case 1:var e=d.find("select").eq(a-1);c.model.selected.key=e.val()+","+i.val(),c.model.selected.value=e.select2("data").text+","+i.select2("data").text;break;case 2:var e=d.find("select").eq(a-1),f=d.find("select").eq(a-2);c.model.selected.key=f.val()+","+e.val()+","+i.val(),c.model.selected.value=f.select2("data").text+","+e.select2("data").text+","+i.select2("data").text}if(k){var j=i;mcs.util.hasAttr(d,"required-level")&&(j=i.parent().parent().find("select[required-level]:last")),b.validate(j,c)}else{var l=d.find("select").eq(a+1);l.empty().append('<option value="">'+h[a+1]+"</option>");var m=i.val();if(c.path)switch(a){case 0:m=c.root+","+m;break;case 1:m=c.root+","+d.find("select").eq(a-1).val()+","+m;break;case 2:m=c.root+","+d.find("select").eq(a-2).val()+","+d.find("select").eq(a-1).val()+","+m}if(mcs.util.bool(c.async)&&i.val()&&(c.params[c.parentKey]=m,c.otherParams))for(var n in c.params)c.otherParams[n]&&(c.params[n]=c.otherParams[n]);g(l,m),l.change()}c.$apply("$scope.model")})}),g(d.find("select").eq(0),c.root)}}}}])}(),function(){"use strict";mcs.ng.directive("mcsCheckboxGroup",["mcsValidationService",function(a){return{restrict:"E",scope:{data:"=",model:"=",defaultKey:"@"},template:'<label class="checkbox-inline" ng-repeat="item in data" ng-class="{\'all\':item.key==-1}" ng-style="customStyle" uib-popover="{{item.value | tooltip:6}}" popover-trigger="mouseenter"><input type="checkbox" class="ace" ng-checked="model && model.indexOf(item.key)!=-1" ng-disabled="disabled" ng-click="change(item, $event)"><span class="lbl"></span> {{item.value | truncate:6}}</label>',controller:function(b){b.defaultKey=b.defaultKey||"-1",b.disabled=mcs.util.bool(b.$parent.disabled),b.change=function(c,d){if(b.model=b.model||[],c.key==b.defaultKey){var e=b.data;if(b.model=[],d.target.checked)for(var f in e){var c=e[f];b.model.push(c.key)}}else{var g=b.data?b.data.length:0;mcs.util.setSelectedItems(b.model,c,d,g,b.defaultKey)}a.validate($(d.target),b)},b.customStyle={},b.$parent.width&&(b.customStyle.width=b.$parent.width)},link:function(a,b){a.$watch("data",function(c){c&&a.$parent.required&&b.find(":checkbox").attr("required","required")})}}}])}(),function(){"use strict";mcs.ng.directive("mcsDatarange",["mcsValidationService",function(a){return{restrict:"E",scope:{css:"@",width:"@",min:"=",minText:"@",max:"=",maxText:"@",datatype:"@",disabled:"@",unit:"@"},templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/datarange.tpl.html",controller:function(a){a.customStyle={},a.width&&(a.customStyle.width=a.width)},link:function(b,c){b.minText=b.minText||"起始金额",b.maxText=b.maxText||"截止金额",b.unit=b.unit||"元",b.disabled=mcs.util.bool(b.disabled||!1);var d=(b.datatype||"number").toLowerCase(),e=c.find("input[type=text]");mcs.util.hasAttr(c,"required")&&(b.required=!0,e.attr("required","required"),mcs.util.appendMessage(c)),"int"==d?e.bind("keyup afterpaste",function(){var a=$(this);mcs.util.limit(a)}):"number"==d&&e.bind("keyup afterpaste",function(){var a=$(this);mcs.util.number(a)}),e.each(function(){var a=$(this);a.next().on("click",function(){b.$apply(function(){b[a.attr("ng-model")]=null})})}),b.$watch("min",function(c){if(void 0!=c&&""!=c){var d=parseFloat(b.max);c>d&&(b.min=d),a.validate(e,b)}}),b.$watch("max",function(c){if(void 0!=c&&""!=c){var d=parseFloat(b.min);d>c&&(b.max=d),a.validate(e,b)}})}}}])}(),function(){angular.module("mcs.ng.paging",[]).controller("pagingController",function(a){}).directive("tmPagination",function(){return{restrict:"EA",template:'<div class="page-list"><ul class="pagination" ng-show="conf.totalCount > 0"><li ng-class="{disabled: conf.pageIndex == 1}" ng-click="prevPage()" style="cursor:pointer;"><span>&laquo;</span></li><li ng-repeat="item in pageList track by $index"  ng-class="{active: item == conf.pageIndex, separate: item == \'...\'}" ng-click="item != conf.pageIndex?changepageIndex(item):null" style="cursor:pointer;"><span>{{ item }}</span></li><li ng-class="{disabled: conf.pageIndex == conf.numberOfPages}" ng-click="nextPage()" style="cursor:pointer;"><span>&raquo;</span></li></ul><div class="page-total" ng-show="conf.totalCount > 0">第 <input type="text" ng-model="jumpPageNum" class="mcs-input-small" ng-keypress="$event.keyCode == 13?jumpToPage($event):null" onkeyup="mcs.util.limit(this)" onafterpaste="mcs.util.limit(this)"/>页 共<strong> {{ conf.totalCount }} </strong>条记录 <button class="btn btn-minier btn-primary" ng-click="jumpToPage($event)"><i class="ace-icon fa bigger-110 fa-mail-forward"></i> 跳 转</button></div><div class="no-items" ng-show="conf.totalCount <= 0">暂无数据</div></div>',replace:!0,scope:{conf:"=",pageChange:"&"},link:function(a,b,c){function d(b,c){a.conf.pageIndex=parseInt(a.conf.pageIndex)?parseInt(a.conf.pageIndex):1,a.conf.totalCount=parseInt(a.conf.totalCount)?parseInt(a.conf.totalCount):0,a.conf.pageSize=parseInt(a.conf.pageSize)?parseInt(a.conf.pageSize):15,a.conf.numberOfPages=Math.ceil(a.conf.totalCount/a.conf.pageSize),a.conf.pageIndex<1&&(a.conf.pageIndex=1),a.conf.numberOfPages>0&&a.conf.pageIndex>a.conf.numberOfPages&&(a.conf.pageIndex=a.conf.numberOfPages),a.jumpPageNum=a.conf.pageIndex;for(var d,e=a.conf.perPageOptions.length,f=0;e>f;f++)a.conf.perPageOptions[f]==a.conf.pageSize&&(d=!0);if(d||a.conf.perPageOptions.push(a.conf.pageSize),a.conf.perPageOptions.sort(function(a,b){return a-b}),a.pageList=[],a.conf.numberOfPages<=a.conf.pagesLength)for(f=1;f<=a.conf.numberOfPages;f++)a.pageList.push(f);else{var g=(a.conf.pagesLength-1)/2;if(a.conf.pageIndex<=g){for(f=1;g+1>=f;f++)a.pageList.push(f);a.pageList.push("..."),a.pageList.push(a.conf.numberOfPages)}else if(a.conf.pageIndex>a.conf.numberOfPages-g){for(a.pageList.push(1),a.pageList.push("..."),f=g+1;f>=1;f--)a.pageList.push(a.conf.numberOfPages-f);a.pageList.push(a.conf.numberOfPages)}else{for(a.pageList.push(1),a.pageList.push("..."),f=Math.ceil(g/2);f>=1;f--)a.pageList.push(a.conf.pageIndex-f);for(a.pageList.push(a.conf.pageIndex),f=1;g/2>=f;f++)a.pageList.push(a.conf.pageIndex+f);a.pageList.push("..."),a.pageList.push(a.conf.numberOfPages)}}a.conf.onChange&&(c!=b&&0==c[0]||a.conf.onChange()),a.$parent.conf=a.conf}a.changepageIndex=function(b){"..."!=b&&(a.conf.pageIndex=b,a.pageChange())},a.conf.pagesLength=parseInt(a.conf.pagesLength)?parseInt(a.conf.pagesLength):9,a.conf.pagesLength%2===0&&(a.conf.pagesLength=a.conf.pagesLength-1),a.conf.perPageOptions||(a.conf.perPageOptions=[10,15,20,30,50]),a.prevPage=function(){a.conf.pageIndex>1&&(a.conf.pageIndex-=1,a.pageChange())},a.nextPage=function(){a.conf.pageIndex<a.conf.numberOfPages&&(a.conf.pageIndex+=1,a.pageChange())},a.jumpToPage=function(){a.jumpPageNum&&(a.conf.pageIndex=a.jumpPageNum,a.pageChange())},a.$watch(function(){a.conf.totalCount||(a.conf.totalCount=0);var b=a.conf.totalCount+" "+a.conf.pageIndex+" "+a.conf.pageSize;return b},d)}}})}(),function(){angular.module("mcs.ng.datatable",[]).controller("datatableController",function(a){a.paginationConf={currentPage:1,itemsPerPage:5,totalItems:20}}).directive("mcsDatatable",function(a){return{restrict:"E",templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/mcs-datatable.tpl.html ",replace:!0,scope:{data:"=",nodataTip:"@?",retrieveData:"&?",pageChanged:"&?",condition:"=?"},link:function(a,b,c,d){if(a.data){a.retrieveData&&a.retrieveData().then(function(){a.reMatchRowsSelected()}),a.selectAll=function(){a.data.selectAll?a.data.rows.forEach(function(b){b.selected=!0;var c={};a.data.keyFields.forEach(function(a){c[a]=b[a]}),mcs.util.removeByObject(a.data.rowsSelected,c),a.data.rowsSelected.push(c)}):a.data.rows.forEach(function(b){b.selected=!1;var c={};a.data.keyFields.forEach(function(a){c[a]=b[a]}),mcs.util.removeByObject(a.data.rowsSelected,c)})},a.rowSelect=function(b){if(a.data.selectAll=!1,"radio"==a.data.selection){var c=a.data.rowsSelected[0]=a.data.rowsSelected[0]||{};a.data.keyFields.forEach(function(a){c[a]=b[a]}),b.selected=!0,a.data.rows.forEach(function(c){b[a.data.keyFields[0]]!=c[a.data.keyFields[0]]&&(c.selected=!1)})}else{var c={};a.data.keyFields.forEach(function(a){c[a]=b[a]}),b.selected?a.data.rowsSelected.push(c):mcs.util.removeByObject(a.data.rowsSelected,c)}},a.pageChange=function(b){angular.equals(a.conditionCopy,a.condition)||angular.copy(a.conditionCopy,a.condition),b()&&b().then(function(){a.reMatchRowsSelected()})},a.reMatchRowsSelected=function(){var b=a.data.rowsSelected,c=a.data.rows,d=a.data.keyFields;if(0!=b.length&&0!=d.length&&0!=c.length)for(var e in b)for(var f in c){var g=0;for(var h in d)c[f][d[h]]==b[e][d[h]]&&(g+=1);g==d.length&&(c[f].selected=!0)}},a.reorder=function(b,c){b.orderDirection="asc"==b.orderDirection||void 0==b.orderDirection?"desc":"asc",b.sortable&&(a.onOrder&&angular.isFunction(a.onOrder())?a.onOrder({dataField:b.sort||b.field,sortDirection:"asc"==b.orderDirection?0:1}):(a.data.orderBy[0].dataField=b.sort||b.field,a.data.orderBy[0].sortDirection="asc"==b.orderDirection?0:1,c(),a.reMatchRowsSelected()))},a.data.searching=function(){a.condition&&(a.conditionCopy={},angular.copy(a.condition,a.conditionCopy))};var e=/click=['"]\w*/gi;a.data.headers.forEach(function(b,c){if(!b.field){var d=b.template&&b.template.match(e);d&&d.forEach(function(b){var c=b.replace('"',"'").split("'")[1];a[c]=a.$parent[c]})}})}}}}).directive("mcsDatatableRow",function(a){return{restrict:"A",link:function(b,c,d){var e=b.$parent.data.headers;b.row;b.vm=b.$parent.$parent.vm,e.forEach(function(d,e){var f=a('<td class="'+d.headerCss+'">'+(d.template||"<span>{{row."+d.field+"}}</span>")+"</td>")(b);c.append(f)})}}})}(),function(){"use strict";mcs.ng.directive("datetimeType",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$formatters.push(function(b){return a("date")(b,"yyyy-MM-dd HH:mm:ss")})}}}),mcs.ng.directive("dateType",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$formatters.push(function(b){return a("date")(b,"yyyy-MM-dd")})}}}),mcs.ng.directive("clearMinDate",function(){function a(a){return!a||a&&"invalid date"==a.toLowerCase()||a.toLowerCase().match(/0001-01-01/)||a&&a.getFullYear&&1==a.getFullYear()?"":a}return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$formatters.unshift(a)}}})}(),function(){"use strict";mcs.ng.directive("mcsDatepicker",["mcsValidationService",function(a){return{restrict:"E",scope:{css:"@",model:"=",placeholder:"@",zIndex:"@",startDate:"=?",endDate:"=?",disabled:"=?"},templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/datepicker.tpl.html",controller:function(a){a.zIndex&&(a.dateStyle={"z-index":a.zIndex})},link:function(b,c){var d=c.find(".date-picker");b.placeholder=b.placeholder||"输入日期",b.disabled=mcs.util.bool(b.disabled||!1),mcs.util.hasAttr(c,"required")&&(b.required=!0,c.find("input[type=text]").attr("required","required"),mcs.util.appendMessage(c)),d.datetimepicker({autoclose:!0,todayBtn:!0,todayHighlight:!0,startDate:b.startDate,endDate:b.endDate,minView:"month",maxView:"decade",format:ppts.config.datePickerFormat,language:ppts.config.datePickerLang}).on("hide",function(){var d=$(this);b.$apply(function(){b.model=""==d.val()?null:moment(d.val()).utc()._d}),a.validate(c.find("input[required]"),b)}).next().on("click",function(){b.$apply(function(){b[d.attr("ng-model")]=null})}).next().on("click",function(){d.focus()})}}}])}(),function(){"use strict";mcs.ng.directive("mcsDaterangepicker",["mcsValidationService",function(a){return{restrict:"E",scope:{width:"@",css:"@",size:"@",mode:"@",startDate:"=?",endDate:"=?",startText:"@",endText:"@",rangeRestrict:"@?",offset:"@?",minutes:"=?",disabled:"@?",zIndex:"@"},templateUrl:function(a,b){return mcs.app.config.mcsComponentBaseUrl+(b.mode&&"datetime"===b.mode.toLowerCase()?"/src/tpl/datetimerangepicker.tpl.html":"/src/tpl/daterangepicker.tpl.html")},controller:function(a){a.dateStyle={},a.zIndex&&(a.dateStyle["z-index"]=a.zIndex),a.width&&(a.dateStyle.width=a.width)},link:function(b,c){var d=c.find(".date-picker,.date-timepicker"),e=d.filter("input[name=start]"),f=d.filter("input[name=end]"),g=parseInt(b.offset),h=parseInt(b.rangeRestrict);b.disabled=b.disabled||"none",b.startText=b.startText||("datetime"==b.mode?"开始时间":"开始日期"),b.endText=b.endText||("datetime"==b.mode?"结束时间":"结束日期"),b.size=b.size||"lg",b.mode=b.mode||"date",mcs.util.hasAttr(c,"required")&&(b.required=!0,c.find("input[type=text]").attr("required","required"),mcs.util.appendMessage(c));var i={autoclose:!0,todayBtn:!0,todayHighlight:!0,language:ppts.config.datePickerLang,startDate:mcs.date.getLeftBoundDatetime(g>=0?b.startDate:b.endDate,g),endDate:mcs.date.getRightBoundDatetime(g>=0?b.startDate:b.endDate,g)};"date"==b.mode?(i.minView="month",i.maxView="decade",i.format=ppts.config.datePickerFormat):i.format=ppts.config.datetimePickerFormat,e.datetimepicker(i).on("changeDate",function(a){f.datetimepicker("setStartDate",new Date(a.date.valueOf())),isNaN(h)||f.datetimepicker("setEndDate",mcs.date.getRightBoundDatetime(b.startDate,h))}).on("hide",function(){var d=$(this);b.$apply(function(){b.startDate=""==d.val()?null:moment(d.val()).utc()._d,0!=g&&0!=h||e.val()&&f.val()&&(b.minutes=mcs.date.datepart(e.val(),f.val(),"m"))}),a.validate(c.find("input[required]"),b)}).next().on("click",function(){b.$apply(function(){b.startDate=null,f.datetimepicker("setStartDate",mcs.date.getLeftBoundDatetime(g>=0?b.startDate:b.endDate,g)),f.datetimepicker("setEndDate",mcs.date.getRightBoundDatetime(g>=0?b.startDate:b.endDate,g))})}).next().on("click",function(){e.focus()}),f.datetimepicker(i).on("changeDate",function(a){e.datetimepicker("setEndDate",new Date(a.date.valueOf())),isNaN(h)||e.datetimepicker("setStartDate",mcs.date.getLeftBoundDatetime(b.endDate,h))}).on("hide",function(){var d=$(this);b.$apply(function(){b.endDate=""==d.val()?null:moment(d.val()).utc()._d,0!=g&&0!=h||e.val()&&f.val()&&(b.minutes=mcs.date.datepart(e.val(),f.val(),"m"))}),a.validate(c.find("input[required]"),b)}).next().on("click",function(){b.$apply(function(){b.endDate=null,e.datetimepicker("setEndDate",mcs.date.getRightBoundDatetime(g>=0?b.startDate:b.endDate,g)),e.datetimepicker("setStartDate",mcs.date.getLeftBoundDatetime(g>=0?b.startDate:b.endDate,g))})}).next().on("click",function(){f.focus()})}}}])}(),function(){"use strict";mcs.ng.directive("mcsDatetimepicker",["mcsValidationService",function(a){return{restrict:"E",scope:{css:"@",model:"=",placeholder:"@",zIndex:"@",startDate:"=?",endDate:"=?",disabled:"=?"},templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/datetimepicker.tpl.html",controller:function(a){a.zIndex&&(a.dateStyle={"z-index":a.zIndex})},link:function(b,c){var d=c.find(".date-timepicker");b.placeholder=b.placeholder||"输入时间",b.disabled=mcs.util.bool(b.disabled||!1),mcs.util.hasAttr(c,"required")&&(b.required=!0,c.find("input[type=text]").attr("required","required"),mcs.util.appendMessage(c)),d.datetimepicker({format:ppts.config.datetimePickerFormat,language:ppts.config.datePickerLang,autoclose:!0,startDate:b.startDate,endDate:b.endDate}).on("hide",function(){var d=$(this);b.$apply(function(){b.model=""==d.val()?null:moment(d.val()).utc()._d}),a.validate(c.find("input[required]"),b)}).next().on("click",function(){b.$apply(function(){b[d.attr("ng-model")]=null})}).next().on("click",function(){d.focus()})}}}])}(),function(){"use strict";mcs.ng.service("mcsDialogService",["dialogs",function(a){var b=this;b.messageConfig={wait:{title:"操作中",message:"操作进行中，请稍后！"},info:{title:"消息",message:"至少选择一条数据！"},error:{title:"错误",message:"操作发生错误，请重试或联系系统管理员！"},confirm:{title:"请确认",message:"确认进行此操作吗？"}},this.info=function(c){return c=jQuery.extend({title:b.messageConfig.info.title,message:b.messageConfig.info.message,settings:{backdrop:"static"}},c),a.notify(c.title,c.message,c.settings)},this.confirm=function(c){return c=jQuery.extend({title:b.messageConfig.confirm.title,message:b.messageConfig.confirm.message,settings:{backdrop:"static"}},c),a.confirm(c.title,c.message,c.settings)},this.error=function(c){return c=jQuery.extend({title:b.messageConfig.error.title,message:b.messageConfig.error.message,settings:{backdrop:"static"}},c),a.error(c.title,c.message,c.settings)},this.wait=function(c){return c=jQuery.extend({title:b.messageConfig.wait.title,message:b.messageConfig.wait.message,settings:{backdrop:"static"}},c),a.wait(c.title,c.message)},this.create=function(b,c){return b?(c=jQuery.extend({controller:"",params:{},settings:{backdrop:"static",size:"md"},controllerAs:"vm"},c),a.create(b,c.controller,c.params,c.settings,c.controllerAs)):void 0}}])}(),function(){"use strict";mcs.ng.directive("parseInputValue",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){if(!c.datatype)return a;var b=c.datatype.toLowerCase();switch(b){case"int":return parseInt(a);case"number":return parseFloat(a);default:return a}})}}}),mcs.ng.directive("mcsInput",["mcsValidationService",function(a){return{restrict:"E",replace:!0,scope:{id:"@",type:"@",placeholder:"@",readonly:"@",css:"@",customStyle:"@",datatype:"@",model:"="},template:'<input placeholder="{{placeholder}}" class="mcs-default-size-input mcs-margin-right-20 {{css}}" popover-trigger="mouseenter" ng-model="model" style="{{customStyle}}" parse-input-value/>',link:function(b,c,d){var e=(b.datatype||"string").toLowerCase();b.id&&c.attr("id",b.id),"int"==e?c.bind("keyup afterpaste",function(){mcs.util.limit(c)}):"number"==e&&c.bind("keyup afterpaste",function(){mcs.util.number(c)}),c.attr("type",b.type||"text");var f=mcs.util.bool(b.readonly);f&&c.attr("disabled","disabled"),b.$watch("$parent.maxlength",function(){b.$parent.maxlength&&c.attr("maxlength",b.$parent.maxlength)}),b.$watch("$parent.required",function(){b.$parent.required&&c.attr("required","required");var d=c.data("events");d&&d.blur||c.blur(function(){a.validate(c,b.$parent)})})}}}])}(),function(){"use strict";mcs.ng.directive("mcsLabel",function(){return{restrict:"E",replace:!0,scope:{required:"@",icons:"@",text:"@",css:"@",prefix:"@?",suffix:"@?"},template:'<label class="control-label {{css}}"> {{value || text}}</label>',controller:function(a){a.required=mcs.util.bool(a.required||!1),a.prefix=a.prefix||"",a.suffix=a.suffix||"：",a.value=""},link:function(a,b,c){if(a.required&&b.prepend('<span class="required">*</span>'),a.icons){var d=mcs.util.toArray(a.icons);d.reverse();for(var e in d){var f=d[e];"caret-up"==f?b.prepend('<i class="ace-icon fa fa-'+f+' red"/> '):b.prepend('<i class="ace-icon fa fa-'+f+' red bigger-70"/> ')}}a.css&&b.addClass(a.css),void 0!=a.prefix&&(a.value+=a.prefix),void 0!=a.suffix&&a.$watch("text",function(b){b&&(a.value+=b.replace(":",a.suffix),-1==b.indexOf(a.suffix)&&(a.value+=a.suffix))})}}})}(),function(){mcs.ng.service("printService",function(){var a=this;return a.checkTargetPageLoaded=function(b,c,d){a.timeoutObj=setTimeout(function(){var e=b.document.getElementById("printDiv");e?(e.innerHTML=d.innerHTML,c&&b.printWindow(c)):(clearTimeout(a.timeoutObj),a.checkTargetPageLoaded())},100)},a.print=function(b){var c=document.getElementById("printArea").cloneNode(!0),d=window.open(mcs.app.config.mcsComponentBaseUrl+"/src/mcs-print/mcs-print.html","","");return mcs.browser.s.msie?void a.checkTargetPageLoaded(d,b,c):void d[d.addEventListener?"addEventListener":"attachEvent"]((d.attachEvent?"on":"")+"load",function(){var a=d.document.getElementById("printDiv");a.innerHTML=c.innerHTML,b&&d.printWindow(b)},!1)},a})}(),function(){"use strict";mcs.ng.directive("mcsRadiobuttonGroup",["mcsValidationService",function(a){return{restrict:"E",scope:{data:"=",model:"=",value:"="},template:'<label class="radio-inline" ng-repeat="item in data" ng-show="item.state==undefined||item.state"><span uib-popover="{{item.tooltip}}" placement="auto" popover-trigger="mouseenter"><input name="{{groupName}}" type="radio" class="ace" ng-checked="item.key==model" ng-disabled="disabled" ng-click="change(item, $event)"><span class="lbl"></span> {{item.value}}</span></label>',controller:function(b){b.groupName=mcs.util.newGuid(),
b.disabled=mcs.util.bool(b.$parent.disabled),b.change=function(c,d){b.model=c.key,b.value=c.value,a.validate($(d.target),b)}},link:function(a,b){b.attr("groupName",a.groupName),a.$watch("data",function(c){c&&a.$parent.required&&b.find(":radio").attr("required","required")})}}}])}(),function(){"use strict";mcs.ng.directive("mcsSelect",["mcsValidationService",function(a){return{restrict:"E",scope:{category:"@",css:"@",caption:"@",filter:"@",prop:"@",model:"=?",data:"=?",value:"=?",selected:"=?",async:"@",callback:"&?",disabled:"=?",parseType:"@",showDefault:"@",isDynamic:"@",ignoreAsync:"@",defaultKey:"@",customStyle:"@?"},template:'<div class="col-sm-12 {{css}}"><select style="width:100%;" ng-disabled="disabled" ng-style="customStyle"></select></div>',link:function(b,c){b.caption=b.caption||"请选择",b.disabled=mcs.util.bool(b.disabled||!1),b.showDefault=mcs.util.bool(b.showDefault||!0),b.isDynamic=mcs.util.bool(b.isDynamic||!1),b.ignoreAsync=mcs.util.bool(b.ignoreAsync||!1),b.async=mcs.util.bool(b.async||!0),b.parseType=b.parseType||"string",b.defaultKey=b.defaultKey||"-1";var d=c.find("select");mcs.util.hasAttr(c,"required")&&(b.required=!0,d.attr("required","required"),mcs.util.appendMessage(c,"mcs-padding-left-15"));var e=function(){var c=ppts.dict[ppts.config.dictMappingConfig[b.category]];b.$watch("filter",function(){if(!mcs.util.bool(b.isDynamic)||""!=b.filter&&void 0!=b.filter)if(b.filter&&b.prop){b.data=[];for(var a in c){var d=c[a],e=b.prop;mcs.util.containsElement(d[e],b.filter)&&b.data.push(d)}}else b.data=c;else b.data=b.data||[]}),b.$watch("data",function(){d.empty(),mcs.util.bool(b.showDefault)&&d.append('<option value="">'+b.caption+"</option>"),$.each(b.data,function(a,c){if(c.parentKey=c.parentKey||"",c.key!=b.defaultKey){var e='<option value="'+c.key+'" parent="'+c.parentKey+'">'+c.value+"</option>";c.key==b.model&&(e='<option value="'+c.key+'" parent="'+c.parentKey+'" selected="selected">'+c.value+"</option>"),d.append(e)}}),d.select2().change(function(){b.model=d.val(),b.value=d.val()?d.select2("data").text:"",b.selected=b.selected||{},b.selected.key=d.val(),b.selected.value=d.select2("data").text==b.caption?"":d.select2("data").text,b.selected.parentKey=$(d.select2("data").element).attr("parent"),"int"==b.parseType&&(b.model=parseInt(b.model)),"float"==b.parseType&&(b.model=parseFloat(b.model)),angular.isFunction(b.callback)&&($.each(b.data,function(a,c){return c.key==b.model?(b.selected.selectItem=c.selectItem,!1):void 0}),b.callback({item:b.selected,model:b.model})),a.validate(d,b),b.$apply("$scope.model")})})};b.model=void 0==b.model?d.val():b.model,b.customStyle&&d.attr("style",b.customStyle),mcs.util.bool(b.ignoreAsync)?(e(),b.category?b.$on("dictionaryReady",e):b.$on("dataReady",e)):b.async?b.category?b.$on("dictionaryReady",e):b.$on("dataReady",e):e()}}}])}(),function(){"use strict";angular.module("mcs.ng.treeControl",[]).constant("treeSetting",{data:{key:{checked:"checked",children:"children",name:"name",title:"name"},simpleData:{enable:!0}},view:{selectedMulti:!0,showIcon:!0,showLine:!0,nameIsHTML:!1,fontCss:{}},callback:{},check:{enable:!0},async:{enable:!0,autoParam:["id"],contentType:"application/json",type:"post"}}).directive("mcsTree",function(a,b){var c;return{restrict:"A",scope:{setting:"=mcsTree",setNodes:"&",distinctLevel:"@?"},link:function(b,d,e,f){var g=null,h=parseInt(b.distinctLevel);b.setting.getRawNodesChecked=function(){return c.getCheckedNodes(!0)},b.setting.clearChecked=function(){c.checkAllNodes(!1)},b.setting.expendCheckedNode=function(a,b){c.expandNode(b,!0,!0,!0)},a.callback.onAsyncSuccess=function(a,b,d,e){c.checkNode(d,!0,!0)},a.callback.beforeCheck=b.setting.expendCheckedNode,b.setting.checkNodes=function(a){a.forEach(function(a){c.checkNode(a,!0,!0)})},b.setting.justCheckWithinSameParent=function(a,c){return c.checked?(0==b.setting.getRawNodesChecked().length&&(g=null),!0):c.level>h?g?(g!=c.getParentNode()&&(b.setting.clearChecked(),g=c.getParentNode()),!0):(g=c.getParentNode(),!0):c.level==h?(g&&b.setting.clearChecked(),g=c.getParentNode(),!0):!1},b.setting.getNodesChecked=function(a){var b=[];return c.getCheckedNodes(!0).forEach(function(c,d){void 0==a||0==a?c.isParent||b.push({id:c.id,name:c.name,level:c.level}):b.push({id:c.id,name:c.name,level:c.level})}),b},b.setting.getNamesOfNodesChecked=function(a){var b=[];return c.getCheckedNodes(!0).forEach(function(c,d){void 0==a||0==a?c.isParent||b.push(c.name):b.push(c.name)}),b},b.setting.getIdsOfNodesChecked=function(a){var b=[];return c.getCheckedNodes(!0).forEach(function(c,d){void 0==a||0==a?c.isParent||b.push(c.id):b.push(c.id)}),b},angular.extend(a,b.setting),b.setNodes()(function(b){b&&(c=$.fn.zTree.init(d,a,b))})}}})}(),function(a){"use strict";angular.module("mcs.ng.uiCopy",[]).controller("uiCopyController",["$scope",function(){}]).directive("mcsUicopy",function(a,b){return{restrict:"E",scope:{data:"=",model:"=?",itemTemplateUrl:"@"},template:'<table style="width:100%" class="table-layout"><tr ng-repeat="row in data track by $index"><td class="mcs-padding-0"><div ng-include="itemTemplateUrl"></div></td></tr></table>',link:function(a,b,c,d){}}})}(),function(){mcs.ng.service("excelImportService",function(a,b){var c=this;return c["import"]=function(a,c){var d=window.open("../src/tpl/mcs-excelImport.tpl.html","_blank","height=600, width=700, toolbar =no, menubar=no, scrollbars=no, resizable=no, location=no, status=no");d.onload=function(){var e=b.get("ppts.user.currentJobId_"+ppts.user.id);d.setParam(angular.extend({pptsCurrentJobID:e},a)),d.setApiUrl(c)}},c.importOnDialog=function(b,c){a.create(b,c)},c})}(),function(){angular.module("mcs.ng.filesUpload",["ngFileUpload"]).directive("filesUpload",["Upload","$timeout","$http",function(a,b,c){return{restrict:"A",templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/upload.tpl.html",scope:{filesAmount:"=?",pattern:"@?",model:"=?",url:"@",errorMessage:"@",downloadUrl:"@",moduleName:"@",resourceId:"@",readonly:"=?"},link:function(c,d,e,f){c.filesUpload=[],c.statusEnum={inserted:1,updated:2,deleted:3},c.fileStatusFilter=function(a){return a.status!=c.statusEnum.deleted},c.delecteFile=function(a){a.status=c.statusEnum.deleted},c.downloadFile=function(a){mcs.util.postMockForm(c.downloadUrl,a)},c.uploadFiles=function(d){angular.forEach(d,function(e){e.upload=a.upload({url:c.url,data:{materialUploadModel:JSON.stringify({materialClass:c.moduleName,resourceID:c.resourceId,originalName:e.name,title:e.title,status:e.status}),file:e}}),e.upload.then(function(a){b(function(){mcs.util.removeByObject(d,e),a.data[0].status=c.statusEnum.inserted,c.model.push(a.data[0])})},function(a){c.errorMsg="上传失败"},function(a){e.progress=Math.min(100,parseInt(100*a.loaded/a.total))})})},c.fileSelect=function(a){a.forEach(function(a,b){a.status=c.statusEnum.inserted,a.title=a.name}),c.uploadFiles(a)}}}}])}(),function(){"use strict";mcs.ng.service("mcsUserTaskService",["$resource",function(a){var b=this,c=a(ppts.config.mcsApiBaseUrl+"api/usertask/:operation/:id",{operation:"@operation",id:"@id"},{post:{method:"POST"},polling:{method:"POST",headers:{pollingTasks:!0}},query:{method:"GET",isArray:!1}});return b.queryUserTasksAndCount=function(a,b,d){c.polling({operation:"QueryUserTasksAndCount"},JSON.stringify(a),b,d)},b.queryUserTasks=function(a,b,d){if(a&&a.dataType){var e="";switch(a.dataType){case"userTask":e="QueryUserTasks";break;case"completedTask":e="QueryUserCompletedTasks";break;case"notify":e="QueryUserNotifies"}c.post({operation:e},JSON.stringify(a),b,d)}},b}])}(),function(){"use strict";mcs.ng.service("mcsValidationService",["mcsValidationRules","mcsValidationMessageConfig","$parse","$timeout",function(a,b,c,d){var e=this,f=function(a,c){var d=$.extend({errorMessage:a.attr("data-validation-custom-message")||b.general,validate:!0},c),e=a.closest(".form-group"),f=a.closest(".row");if(e&&e.length){var g=e.find(".help-block"),h=f.find(".form-group");g&&g.length||(1==h.length?e.append('<div class="help-block horizontal"></div>'):a.parent().append('<div class="help-block"></div>'),g=e.find(".help-block")),d.validate?(e.removeClass("validate has-error"),g.text("").css("visibility","hidden")):(e.addClass("validate has-error"),g.text(d.errorMessage).css("visibility","visible"))}else{var g=a.parent().find(".help-block");g&&g.length||(a.parent().append('<div class="help-block"></div>'),g=a.parent().find(".help-block")),d.validate?(a.removeClass("has-error"),a.parent().find(".control-label").removeClass("has-error"),g.removeClass("has-error").text("").css("visibility","hidden")):(a.addClass("has-error"),a.parent().find(".control-label").addClass("has-error"),g.addClass("has-error").text(d.errorMessage).css("visibility","visible"))}return mcs.util.hasAttr(a,"submit-validate")&&mcs.util.hasAttr(a,"ignore-hidden")||a.attr("data-validate-result",d.validate),d.validate},g=function(b,c){var d=b?$("input, select, textarea",b):$("input, select, textarea");d.each(function(){var b=$(this);return(!b.is(":hidden")||mcs.util.hasAttr(b,"ignore-hidden")||b.is("select")&&b.next().hasClass("select2-container"))&&!b.is(":file")&&!b.closest(".form-group").is(":hidden")&&mcs.util.hasAttrs(b,a)?void(mcs.util.hasAttr(b,"data-validate-result")||"function"==typeof c&&c(b)):!0})};return e.check=function(a,b){return f(a,b)},e.validate=function(c,e){var g=!0;if(!mcs.util.hasAttrs(c,a))return g;if(g&&mcs.util.hasAttr(c,"required")){var h=c.is("select")&&c.parent().siblings().not(":hidden").length>0;g=f(c,{errorMessage:c.attr("data-validation-required-message")||function(){return c.is(":checkbox")||c.is(":radio")?b.selected:c.is("select")?h?b.requiredAll:b.selected:b.required}(),validate:function(){if(c.is(":checkbox"))return void 0==e.model?c.closest("label").parent().find(":checkbox:checked").length>0:e.model.length>0;if(c.is(":radio"))return void 0==e.model?c.closest("label").parent().find(":radio:checked").length>0:!!e.model;if(c.is("select")){if(h){var a=!0;return c.parent().not(":hidden").find("select[required]").each(function(){var b=$(this);return 0==$.trim(b.find("option:selected").val()).length?(a=!1,!1):void 0}),a}return void 0==e.model?$.trim(c.find("option:selected").val()).length>0:!!e.model}if(mcs.util.hasClasses(c,"date-picker data-range")){var b=!0;return c.each(function(){var a=$(this);return 0==$.trim(a.val()).length?(b=!1,!1):void 0}),b}return $.trim(c.val()).length>0}()})}if(g&&mcs.util.hasAttr(c,"required-level")){var i=c.closest(".mcs-cascading-select-container");if(i){var j=parseInt(i.attr("required-level"));j>0&&(g=f(c,{errorMessage:c.attr("data-validation-required-message")||mcs.util.format(b.requiredLevel,j),validate:function(){var a=!0;return c.parent().not(":hidden").find("select[required-level]").each(function(b){var c=$(this);return 0==$.trim(c.find("option:selected").val()).length?(a=!1,!1):void 0}),a}()}))}}var k=g&&!mcs.util.hasAttrs(c,"required required-level")&&0==$.trim(c.val()).length;if(g&&mcs.util.hasAttr(c,"minlength")){var l=parseInt(c.attr("minlength"));l>0&&(g=f(c,{errorMessage:c.attr("data-validation-minlength-message")||mcs.util.format(b.minlength,l),validate:k||$.trim(c.val()).length>=l}))}if(g&&mcs.util.hasAttr(c,"maxlength")){var m=parseInt(c.attr("maxlength"));m>0&&(g=f(c,{errorMessage:c.attr("data-validation-maxlength-message")||mcs.util.format(b.maxlength,m),validate:k||$.trim(c.val()).length<=m}))}if(g&&mcs.util.hasAttr(c,"min")){var n=parseFloat(c.attr("min"));g=f(c,{errorMessage:c.attr("data-validation-min-message")||mcs.util.format(b.min,n),validate:k||parseFloat($.trim(c.val()))>=n})}if(g&&mcs.util.hasAttr(c,"max")){var o=parseFloat(c.attr("max"));g=f(c,{errorMessage:c.attr("data-validation-max-message")||mcs.util.format(b.max,o),validate:k||parseFloat($.trim(c.val()))<=o})}if(g&&mcs.util.hasAttr(c,"positive")&&(g=f(c,{errorMessage:c.attr("data-validation-positive-message")||b.positive,validate:k||"0"==$.trim(c.val())||/^[1-9]+[0-9]*$/.test($.trim(c.val()))})),g&&mcs.util.hasAttr(c,"negative")&&(g=f(c,{errorMessage:c.attr("data-validation-negative-message")||b.negative,validate:k||"0"==$.trim(c.val())||/^-[1-9]+[0-9]*$/.test($.trim(c.val()))})),g&&mcs.util.hasAttr(c,"number")&&(g=f(c,{errorMessage:c.attr("data-validation-number-message")||b.number,validate:k||/^(([1-9]\d*)|0)(\.\d+)?$/.test($.trim(c.val()))})),g&&mcs.util.hasAttr(c,"currency")&&(g=f(c,{errorMessage:c.attr("data-validation-currency-message")||b.currency,validate:k||/^(([1-9]\d*)|0)(\.\d{1,2})?$/.test($.trim(c.val()))})),g&&mcs.util.hasAttr(c,"less")){var p=parseFloat(c.attr("less"));g=f(c,{errorMessage:c.attr("data-validation-less-message")||mcs.util.format(b.less,p),validate:k||parseFloat($.trim(c.val()))>p})}if(g&&mcs.util.hasAttr(c,"great")){var q=parseFloat(c.attr("great"));g=f(c,{errorMessage:c.attr("data-validation-great-message")||mcs.util.format(b.great,q),validate:k||parseFloat($.trim(c.val()))<q})}if(g&&mcs.util.hasAttr(c,"between")){var r=c.attr("between").split(",");if(2==r.length){var n=parseFloat(r[0]),o=parseFloat(r[1]);isNaN(n)||isNaN(o)||(g=f(c,{errorMessage:c.attr("data-validation-between-message")||mcs.util.format(b.between,n,o),validate:k||parseFloat($.trim(c.val()))>=n&&parseFloat($.trim(c.val()))<=o}))}}return g&&mcs.util.hasAttr(c,"phone")&&(g=f(c,{errorMessage:c.attr("data-validation-phone-message")||b.phone,validate:k||/(^1[34578]\d{9}$)|(^\d{3,4}-\d{7,8}-\d{1,5}$)|(^\d{3,4}-\d{7,8}$)/.test($.trim(c.val()))})),g&&mcs.util.hasAttr(c,"email")&&(g=f(c,{errorMessage:c.attr("data-validation-email-message")||b.email,validate:k||/^[0-9a-z][_.0-9a-z-]{0,31}@([0-9a-z][0-9a-z-]{0,30}[0-9a-z]\.){1,4}[a-z]{2,4}$/.test($.trim(c.val()))})),g&&mcs.util.hasAttr(c,"idcard")&&(g=f(c,{errorMessage:c.attr("data-validation-idcard-message")||b.idcard,validate:k||/^(\d{18,18}|\d{15,15}|\d{17,17}x|\d{17,17}X)$/.test($.trim(c.val()))})),g&&mcs.util.hasAttr(c,"validate")&&d(function(){return k||e.$eval(c.attr("validate"))},200,!0),g},e.init=function(a,b){a.$on("$viewContentLoaded",function(c){g(b,function(b){(b.is(":input[type=text]")||b.is("textarea"))&&b.blur(function(){e.validate(b,a)})})})},e.run=function(a,b){return g(b,function(b){!b.is(":input[type=text]")&&!b.is("textarea")||mcs.util.hasClasses(b,"date-picker date-timepicker data-range")?e.validate(b,a):b.blur()}),!$(".has-error").length},e}]).constant("mcsValidationRules",["required","required-level","minlength","maxlength","min","max","positive","negative","number","currency","great","less","between","phone","email","idcard","validate"]).constant("mcsValidationMessageConfig",{general:"输入数据项不正确，请重新输入!",required:"输入数据项为必填！",requiredLevel:"请选择到第{0}级数据！",requiredAll:"请选择所有级别数据！",selected:"请至少选择一项！",minlength:"应至少输入{0}个字符！",maxlength:"最多只能输入{0}个字符！",min:"输入数据项应大于或等于{0}！",max:"输入数据项应小于或等于{0}！",positive:"输入数据项应为正整数！",negative:"输入数据项应为负整数！",number:"输入数据项应为小数！",currency:"输入数据项应为货币值(最多保留两位小数)！",great:"输入数据项应小于{0}！",less:"输入数据项应大于{0}！",between:"输入数据项应在{0}和{1}之间！",phone:"输入数据项不是合法电话！",email:"输入数据项不是合法电子邮件！",idcard:"输入数据项不是合法身份证号！",custom:"输入数据项不合法！"})}(),function(){"use strict";mcs.ng.directive("mcsWorkflowStep",function(){return{restrict:"E",scope:{model:"="},controller:function(a){a.$watch("model",function(a){if(a&&mcs.util.isArray(a.activities)){var b=a.activities,c=mcs.util.indexOf(b,function(a){return a.isActive});for(var d in b){var e=b[d];e.isComplete=c>d}}})},templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/mcs-workflow-step.tpl.html"}}),mcs.ng.directive("mcsWorkflowHistory",["$stateParams","mcsWorkflowService",function(a,b){return{restrict:"E",scope:{model:"="},controller:function(b){b.data={keyFields:["activityID"],headers:[{field:"activityName",name:"审批岗位"},{field:"approver",name:"审批人"},{field:"action",name:"审批结果"},{field:"comment",name:"意见",template:'<span uib-popover="{{row.comment|tooltip:20}}" popover-trigger="mouseenter">{{row.comment | truncate:20}}</span>'},{field:"startTime",name:"审批时间",template:'<span>{{row.approvalTime | date: "yyyy-MM-dd HH:mm" | normalize}}</span>'}],pagable:!1,orderBy:[{dataField:"approvalTime",sortDirection:1}]},b.params={processID:a.pid,activityID:a.aid,resourceID:a.rid},b.$watch("model",function(a){if(a){var c=a.activityHistories&&a.activityHistories.length?a.activityHistories:a.activities;mcs.util.isArray(c)&&(b.data.rows=c.filter(function(a){return"Completed"!=a.activityStatus||"Aborted"!=a.activityStatus}))}})},template:'<mcs-datatable data="data" />'}}]),mcs.ng.directive("mcsWorkflowComment",function(){return{restrict:"E",scope:{model:"="},template:'<textarea ng-model="model.currentOpinion.content" rows="7" class="mcs-width-full"></textarea>'}}),mcs.ng.directive("mcsWorkflowToolbar",function(){return{restrict:"E",scope:{model:"="},controller:function(a){a["switch"]=a.$parent["switch"],a.callbacks=a.$parent.callbacks},templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/mcs-workflow-toolbar.tpl.html"}}),mcs.ng.directive("mcsWorkflow",["$state","mcsWorkflowService",function(a,b){return{restrict:"E",scope:{model:"=",callbacks:"=?"},templateUrl:mcs.app.config.mcsComponentBaseUrl+"/src/tpl/mcs-workflow.tpl.html",controller:function(c){c.callbacks=c.callbacks||{},c.$watch("model",function(d){if(d){c["switch"]=d.uiSwitches;var e={processID:c.model.processID,resourceID:c.model.resourceID};c.moveTo=function(){e.currentOpinion=c.model.currentOpinion,angular.isFunction(c.callbacks.moveTo)?b.moveto(e,function(a){c.model=a,c.callbacks.moveTo()()}):b.moveto(e,function(a){c.model=a})},c.cancel=function(){e.currentOpinion=c.model.currentOpinion,angular.isFunction(c.callbacks.cancel)?b.cancel(e,function(a){c.model=a,c.callbacks.cancel()()}):b.cancel(e,function(a){c.model=a})},c.save=function(){e.currentOpinion=c.model.currentOpinion,angular.isFunction(c.callbacks.save)?b.save(e,function(a){c.model=a,c.callbacks.save()()}):b.save(e,function(b){c.model=b,a.reload()})},c.withdraw=function(){angular.isFunction(c.callbacks.withdraw)?b.withdraw(e,function(a){c.model=a,c.callbacks.withdraw()()}):b.withdraw(e,function(b){c.model=b,a.reload()})}}})}}}])}(),function(){"use strict";mcs.ng.service("mcsWorkflowService",["$resource",function(a){var b=this,c=a(ppts.config.workflowApiBaseUrl+"api/workflow/:operation/:id",{operation:"@operation",id:"@id"},{post:{method:"POST"},polling:{method:"POST",headers:{pollingTasks:!0}},query:{method:"GET",isArray:!1}});return b.goBack=function(){history.back()},b.startup=function(a,b,d){c.post({operation:"Startup"},JSON.stringify(a),b,d)},b.startupFreeSteps=function(a,b,d){c.post({operation:"StartupFreeSteps"},JSON.stringify(a),b,d)},b.getClientProcess=function(a,b,d){c.post({operation:"GetClientProcess"},JSON.stringify(a),b,d)},b.moveto=function(a,b,d){c.post({operation:"Moveto"},JSON.stringify(a),b,d)},b.cancel=function(a,b,d){c.post({operation:"Cancel"},JSON.stringify(a),b,d)},b.save=function(a,b,d){c.post({operation:"Save"},JSON.stringify(a),b,d)},b.withdraw=function(a,b,d){c.post({operation:"Withdraw"},JSON.stringify(a),b,d)},b.getForm=function(a,b,d){c.post({operation:"GetForm"},JSON.stringify(a),b,d)},b}])}();